# インデックスを理解する

##　インデックスの仕組み

インデックス(index)とは、索引の意味をもつ英単語でデータベースの表への検索処理を高速化させるもの。
データの検索は上から１つずつ探していく方法もあるが、大量にデータがある場合は効率が悪い。
例えば下記のようなテーブルがあるとする。

|No|name|age|address|position|
|----|----|----|----|----|
|1|Yamamoto|32|Nagoya|employee|
|2|Abe|28|Tokyo|employee|
|3|Kimura|36|Chiba|leader|
|4|Hatano|41|Osaka|manager|
|5|Ono|25|Tokyo|employee|

上記のテーブルからnameの値を検索する場合、データが順番に並んでいないためインデックスを作成すると効率がよくなる。

nameに対してインデックスをはった場合

|No|name|
|----|----|
|2|Abe|28|
|4|Hatano|
|3|Kimura|
|5|Ono|25|
|1|Yamamoto|

上記のように作られ、検索する際に高速になる。
ただ、インデックスを導入する際にメリットデメリットがある。

・インデックスを貼るメリット

データ参照の高速化
ソート作業の省略化

・インデックスを貼るデメリット

インデックスの情報を保存するため、ディスク容量を消費する
データが書き換えられるとインデックスも書き換えるので
INSERT/UPDATE/DELETE文のオーバーヘッドが増える

メリットデメリットを考えて導入する方が良い

## Slow query Logを調べる必要性

SQLの実行時間が指定した時間よりもかかってしまったSQLを全て出力することができる。
これにより、アプリケーション構築時や本番運用時にパフォーマンスのボトルネックとなっている
SQLを発見するのに大いに役に立つ。

スロークエリログが出力されるということは、応答に時間がかかったSQLがあったということのため
インデックスが適切に利用されていない場合がある。

そのため、先輩はパフォーマンスが悪くなっている事を懸念していると考えられる。

## カーディナリティとは何でしょうか

カーディナリティとはテーブルにカラムがあるとして、カラムに格納されているデータの種類がどのくらいあるのかを
カーディナリティという。

16/high-low-cardinality-dimensions.png


カラムに格納されているデータの種類が少ない場合は「カーディナリティが低い」といい、
カラムに格納されているデータの種類が多い場合は「カーディナリティが高い」という。

つまり、性別カラムにmen,womanの二つしか入らない場合は「カーディナリティが低い」し
Customer ID 111,222,1444のように一つのカラムにたくさんの一意な値が入る場合は
「カーディナリティが高い」という

## カバリングインデックスの説明

本体のテーブルを参照せずにインデックスのみを見る事をカバリングインデックスと呼ばれている。
つまり全てのSQLがインデックスだけを指している状態。